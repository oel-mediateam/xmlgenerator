$(document).ready(function(){var g=false,topicNum=5,lessonError=false,instructorError=false,topicError=false,dropZone=document.getElementById('drop_zone');initialize();function initialize(){if(window.File&&window.FileReader&&window.FileList){$('#browse, #closeFile').click(function(){$('#fileModel').modal('toggle');$('#fileResult').html('')})}else{$('#browse').addClass('disabled').removeClass('btn-primary').addClass('btn-danger').html('<i class="icon-warning-sign icon-white"></i> Your browser does not support local file upload.')}dropZone.addEventListener('dragover',handleDragOver,false);dropZone.addEventListener('drop',handleFileSelect,false);applyTinymce('#profile');applyTinymce('#topicNote1');applyTinymce('#topicNote2');applyTinymce('#topicNote3');applyTinymce('#topicNote4');applyTinymce('#topicNote5');$('#xmlArea').hide();$('.loader').hide();$('#closeModel').bind('click',function(){$('#areUSure').modal('toggle')});$('#player a').bind('click',function(){if(g===false){$('.tab-pane').show('slow');$(this).removeClass('tabShadow');$(this).html('<i class="icon-chevron-up"></i> SELECT A DIFFERENT XML FILE');g=true}else{$('.tab-pane').hide('slow');$(this).addClass('tabShadow');$(this).html('<i class="icon-chevron-down"></i> SELECT A DIFFERENT XML FILE');g=false}});$('#plusMoreTopic').bind('click',function(){var a=$('#topicNumInput').val();if(!isNaN(a)){for(var i=1;i<=a;i++){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"><span class="number">'+topicNum+'</span></div><div class="span11"><label for="topic'+topicNum+'">Topic title:</label><input type="text" class="span11" name="topic'+topicNum+'" id="topic'+topicNum+'" /><label for="topicNote'+topicNum+'">Note:</label><textarea type="text" class="span11 tinymce" name="topicNote'+topicNum+'" id="topicNote'+topicNum+'"></textarea><p><small><em>Leave it blank will default to "There are no notes for this slide."</em></small></p></div></div>');applyTinymce('#topicNote'+topicNum)}$('#topicNumInput').val(5);if($('#topicNumInput').hasClass('error')===true){$('#topicNumInput').removeClass('error')}$('.errorText').hide('fast')}else{if($('#topicNumInput').hasClass('error')===false){$('#topicNumInput').addClass('error')}$('.errorText').show('slow')}});$('#plusTopic').bind('click',function(){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"><span class="number">'+topicNum+'</span></div><div class="span11"><label for="topic'+topicNum+'">Topic title:</label><input type="text" class="span11" name="topic'+topicNum+'" id="topic'+topicNum+'" /><label for="topicNote'+topicNum+'">Note:</label><textarea type="text" class="span11 tinymce" name="topicNote'+topicNum+'" id="topicNote'+topicNum+'"></textarea><p><small><em>Leave it blank will default to "There are no notes for this slide."</em></small></p></div></div>');applyTinymce('#topicNote'+topicNum)});$('#minusTopic').bind('click',function(){var a=$('.topic:nth-child('+topicNum+')');if(topicNum>1){a.remove();topicNum--;$('#areUSure').modal('toggle')}else{alert('Sorry, you are trying to remove the last topic left on the page. The XML must contains at least one topic.')}});$('#backToTop').bind('click',function(){$('html, body').animate({scrollTop:0},'slow');$('#down').show()});$('#down').bind('click',function(a){a.preventDefault();$('html, body').animate({scrollTop:$(this.hash).offset().top},'slow')});$('#getCode').bind('click',function(){var a=new Date();var b=(a.getMonth()+1)+'/'+(a.getDate())+'/'+a.getFullYear()+'|'+a.getHours()+':'+a.getMinutes()+':'+a.getSeconds();$('#xmlOutput').val('<?xml version="1.0" encoding="UTF-8"?>\n<!-- Generated on '+b+' -->\n<course>\n'+getPlayerSetup()+getProfile()+getTopics()+'</course>');$('a#getCode').fancybox({'hideOnContentClick':false,'scrolling':'auto','autoScale':true,'autoDimensions':true,'centerOnScroll':true});if(lessonError){$('#xmlError').html('<p>Lesson name is required.</p>')}if(instructorError){$('#xmlError').append('<p>Instructor\'s name is required.</p>')}if(topicError){$('#xmlError').append('<p>One or more of your topic titles is not specified.</p>')}})}function getPlayerSetup(){var a='<!-- PLAYER SETUP -->\n';a+='<setup>\n';if(isEmpty($('#lesson').val())){a+='<lesson>LESSON NAME IS NOT SPECIFIED</lesson>\n';$('#lesson').addClass('error');$('#lesson').attr('placeholder','REQUIRED');lessonError=true}else{a+='<lesson>'+$('#lesson').val()+'</lesson>\n';if($('#lesson').hasClass('error')){$('#lesson').removeClass('error');lessonError=false}}if(isEmpty($('#instructor').val())){a+='<instructor>INSTRUCTOR\'S NAME IS NOT SPECIFIED</instructor>\n';$('#instructor').addClass('error');$('#instructor').attr('placeholder','REQUIRED');instructorError=true}else{a+='<instructor>'+$('#instructor').val()+'</instructor>\n';if($('#instructor').hasClass('error')){$('#instructor').removeClass('error');instructorError=false}}if($('#slideFolder').val().length<=0||$('#slideFolder').val()===''||isEmpty($('#slideFolder').val())){a+='<slideFolder />\n'}else{a+='<slideFolder>'+$('#slideFolder').val()+'</slideFolder>\n'}if($('#slide').val().length<=0||$('#slide').val()===''||isEmpty($('#slide').val())){a+='<slideName />\n'}else{a+='<slideName>'+$('#slide').val()+'</slideName>\n'}if($('#imageType').val()==='jpg'){a+='<imgType />\n'}else{a+='<imgType>'+$('#imageType').val()+'</imgType>\n'}a+='</setup>\n';return a}function getProfile(){var a='<!-- PROFILE DATA -->\n';a+='<profile>';if($('#profile').val().length<=0||$('#profile').val()===""||isEmpty($('#profile').val())){a+="Instructor's profile pending..."}else{a+='<![CDATA['+$('#profile').val()+']]>'}a+='</profile>\n';return a}function getTopics(){var a='<!-- TOPICS -->\n';for(var i=1;i<=topicNum;i++){if($('#topic'+i).val()<=""||$('#topic'+i).val().length<=0||isEmpty($('#topic'+i).val())){a+='<topic title="REQUIRED">';$('#topic'+i).addClass('error');$('#topic'+i).attr('placeholder','REQUIRED');topicError=true}else{a+='<topic title="'+$('#topic'+i).val().replace('\&','&amp;')+'">';if($('#topic'+i).hasClass('error')){$('#topic'+i).removeClass('error');topicError=false}}if($('#topicNote'+i).val()<=""||$('#topicNote'+i).val().length<=0||isEmpty($('#topicNote'+i).val())){a+='There are no notes for this slide.</topic>\n'}else{a+='<![CDATA['+$('#topicNote'+i).val()+']]></topic>\n'}}return a}function isEmpty(a){var b=/^[\s ]*$/gi;return b.test(a)}function handleFileSelect(a){var b=a.dataTransfer.files[0];var c;a.stopPropagation();a.preventDefault();if(b.type!='text/xml'){c='<p style="color:#f00"><strong>'+escape(b.name)+'</strong> is not an XML file. It is a(n) '+(b.type||'unknown')+'. Please try again.</p>'}else{$('.loader').css('display','block');c='<p><strong>'+escape(b.name)+'</strong> - '+b.size+' bytes'+'</p>';c+='<p>Uploading ...</p>';loadXML(b)}$('#fileResult').html(c)}function handleDragOver(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect='copy'}function loadXML(d){if(d){var f=new FileReader();f.onload=(function(c){return function(e){var a=new DOMParser();var b=a.parseFromString(e.target.result,"text/xml");$('#fileResult').append('<p>Reading ... </p>');if(b.getElementsByTagName("course")[0]==undefined){$('#fileResult').append('<p class="error"><i class="icon-warning-sign icon"></i> The uploaded XML file is not the correct file for this player. Please double check your XML file and try again.</p>')}else{parseXML(b)}}})(d);f.readAsText(d,'UTF-8')}else{$('#fileResult').append('<p><i class="icon-warning-sign icon-white"></i> Failed to read XML.</p>')}}function parseXML(a){var b=a.getElementsByTagName("topic").length,needMore=a.getElementsByTagName("topic").length-topicNum,lesson=a.getElementsByTagName("lesson")[0].childNodes[0].nodeValue,instructor=a.getElementsByTagName("instructor")[0].childNodes[0].nodeValue,slideFolder,slideName,imageType,profile=a.getElementsByTagName("profile")[0].childNodes[0].nodeValue;$('#fileResult').append('<p>Filling form ...</p>');$("#lesson").val(lesson);$("#instructor").val(instructor);if(!a.getElementsByTagName("slideFolder")[0].childNodes.length==0){slideFolder=a.getElementsByTagName("slideFolder")[0].childNodes[0].nodeValue;$("#slideFolder").val(slideFolder)}if(!a.getElementsByTagName("slideName")[0].childNodes.length==0){slideName=a.getElementsByTagName("slideName")[0].childNodes[0].nodeValue;$("#slide").val(slideName)}if(!a.getElementsByTagName("imgType")[0].childNodes.length==0){imageType=a.getElementsByTagName("imgType")[0].childNodes[0].nodeValue;$("#imageType").val(imageType)}$("#profile").val(profile);for(var i=1;i<=needMore;i++){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"><span class="number">'+topicNum+'</span></div><div class="span11"><label for="topic'+topicNum+'">Topic title:</label><input type="text" class="span11" name="topic'+topicNum+'" id="topic'+topicNum+'" /><label for="topicNote'+topicNum+'">Note:</label><textarea type="text" class="span11 tinymce" name="topicNote'+topicNum+'" id="topicNote'+topicNum+'"></textarea><p><small><em>Leave it blank will default to "No notes available."</em></small></p></div></div>');applyTinymce('#topicNote'+topicNum)}for(var i=0;i<b;i++){$('#topic'+(i+1)).val(a.getElementsByTagName("topic")[i].attributes.getNamedItem("title").value);$('#topicNote'+(i+1)).val(a.getElementsByTagName("topic")[i].childNodes[0].nodeValue)}$('#fileResult').append('<p>Finished! Your XML has been uploaded successfully.</p>');$('.loader').css('display','none')}function applyTinymce(a){$(a).tinymce({script_url:'scripts/tiny_mce/tiny_mce.js',theme:"advanced",skin:"o2k7",skin_variant:"silver",plugins:"autolink,lists,pagebreak,table,advlink,iespell,inlinepopups,paste,directionality,noneditable,visualchars,nonbreaking,xhtmlxtras,template,advlist",theme_advanced_buttons1:"bold,italic,underline,forecolor,|,justifyleft,justifycenter,justifyright,|,bullist,numlist,sub,sup,|,link,unlink,charmap,|,tablecontrols,|,visualaid,",theme_advanced_buttons2:"cut,copy,paste,removeformat,code,cleanup,help",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_resizing:true,content_css:"css/tinymce.css",template_external_list_url:"lists/template_list.js",external_link_list_url:"lists/link_list.js",})}});