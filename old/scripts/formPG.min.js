// formPG.min.js
// by Ethan S. Lin
// 12/14/2012 @ 12:52 PM

$(document).ready(function(){var g=false,topicNum=5,gTitleError=false,fileError=false,topicError=false,dropZone=document.getElementById('drop_zone');initialize();function initialize(){if(window.File&&window.FileReader&&window.FileList){$('#browse, #closeFile').click(function(){$('#fileModel').modal('toggle');$('#fileResult').html('');$('.loader').hide()})}else{$('#browse').addClass('disabled').removeClass('btn-primary').addClass('btn-danger').html('<i class="icon-warning-sign icon-white"></i> Your browser does not support local file upload.')}dropZone.addEventListener('dragover',handleDragOver,false);dropZone.addEventListener('drop',handleFileSelect,false);$('#xmlArea').hide();$('.loader').hide();$('#closeRUModel').bind('click',function(){$('#areUSure').modal('toggle')});$('#closeSRYModel').bind('click',function(){$('#sorryNoCanDo').modal('toggle')});$('#player a').bind('click',function(){if(g===false){$('.tab-pane').show('slow');$(this).removeClass('tabShadow');$(this).html('<i class="icon-chevron-up"></i> SELECT A DIFFERENT XML FILE');g=true}else{$('.tab-pane').hide('slow');$(this).addClass('tabShadow');$(this).html('<i class="icon-chevron-down"></i> SELECT A DIFFERENT XML FILE');g=false}});$('#duration').bind('change',function(){$(this).val().replace('/(\s)/','');if(isNaN($(this).val())){$(this).val('').attr('placeholder','enter a number').addClass('error')}else{if($(this).hasClass('error')){$(this).removeClass('error')}if($(this).val().match(' ')){$(this).val('').attr('placeholder','i.e.: 2, 3, 5, etc.');if(!$('#group').hasClass('hide')){$('.groupRow').html('');$('#group').addClass('hide')}}}});applyTinymce('#galleryDesc');applyTinymce('#vDes1');applyTinymce('#vDes2');applyTinymce('#vDes3');applyTinymce('#vDes4');applyTinymce('#vDes5')}$('#plusMoreTopic').bind('click',function(){var a=$('#topicNumInput').val();if(!isNaN(a)){for(var i=1;i<=a;i++){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"> <span class="number">'+topicNum+'</span></div><div class="span11"><div class="row"><div class="span5"><label for="fName'+topicNum+'">File Name:</label><input type="text" class="span5" name="fName'+topicNum+'" id="fName'+topicNum+'"/></div><div class="span6"><label for="topic'+topicNum+'">Image title:</label><input type="text" class="span6" name="topic'+topicNum+'" id="topic'+topicNum+'"/></div><div class="span11"><label for="vDes'+topicNum+'">Images description:</label><textarea class="span11" name="vDes'+topicNum+'" id="vDes'+topicNum+'"></textarea></div></div></div></div>');applyTinymce('#vDes'+topicNum)}$('#topicNumInput').val(5);if($('#topicNumInput').hasClass('error')===true){$('#topicNumInput').removeClass('error')}$('.errorText').hide('fast')}else{if($('#topicNumInput').hasClass('error')===false){$('#topicNumInput').addClass('error')}$('.errorText').show('slow')}});$('#plusTopic').bind('click',function(){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"> <span class="number">'+topicNum+'</span></div><div class="span11"><div class="row"><div class="span5"><label for="fName'+topicNum+'">File Name:</label><input type="text" class="span5" name="fName'+topicNum+'" id="fName'+topicNum+'"/></div><div class="span6"><label for="topic'+topicNum+'">Image title:</label><input type="text" class="span6" name="topic'+topicNum+'" id="topic'+topicNum+'"/></div><div class="span11"><label for="vDes'+topicNum+'">Images description:</label><textarea class="span11" name="vDes'+topicNum+'" id="vDes'+topicNum+'"></textarea></div></div></div></div>');applyTinymce('#vDes'+topicNum)});$('#minusTopic').bind('click',function(){var a=$('div.topic:last');if(topicNum>1){a.remove();topicNum--;$('#areUSure').modal('toggle')}else{$('#areUSure').modal('toggle');$('#sorryNoCanDo').modal('toggle')}});$('#backToTop').bind('click',function(){$('html, body').animate({scrollTop:0},'slow');$('#down').show()});$('#down').bind('click',function(a){a.preventDefault();$('html, body').animate({scrollTop:$(this.hash).offset().top},'slow')});$('#getCode').bind('click',function(){var a=new Date();var b=(a.getMonth()+1)+'/'+(a.getDate())+'/'+a.getFullYear()+'|'+a.getHours()+':'+a.getMinutes()+':'+a.getSeconds();$('#xmlOutput').val('<?xml version="1.0" encoding="UTF-8"?>\n<!-- Generated on '+b+' -->\n<gallery>\n'+getPlayerSetup()+getTopics()+'</gallery>');$('a#getCode').fancybox({'hideOnContentClick':false,'scrolling':'auto','autoScale':true,'autoDimensions':true,'centerOnScroll':true});$('#xmlError').html('');$('#xmlError').append('<ul>');if(gTitleError){$('#xmlError ul').append('<li>Gallery title is required.</li>')}if(fileError){$('#xmlError ul').append('<li>One or more of the image file name is not specified.</li>')}if(topicError){$('#xmlError ul').append('<li>One or more of the image title is not specified.</li>')}$('#xmlError').append('</ul>')});function getPlayerSetup(){var a='<!-- PHOTO GALLERY SETUP -->\n';a+='<setup>\n';if($('#galleryTitle').val()==0||isEmpty($('#galleryTitle').val())){a+='<title />\n';$('#galleryTitle').addClass('error');$('#galleryTitle').attr('placeholder','REQUIRED');gTitleError=true}else{a+='<title>'+$('#galleryTitle').val()+'</title>\n';if($('#galleryTitle').hasClass('error')){$('#galleryTitle').removeClass('error');gTitleError=false}}if($('#galleryDesc').val()==0||isEmpty($('#galleryDesc').val())){a+='<description /> <!-- no description -->\n'}else{a+='<description><![CDATA['+$('#galleryDesc').val()+']]></description>\n'}if($('#imageType').val()==='png'){a+='<imgFormat /> <!-- default image type applied -->\n'}else{a+='<imgFormat>'+$('#imageType').val()+'</imgFormat>\n'}if($('#duration').val()==0||isEmpty($('#duration').val())){a+='<slideDuration /> <!-- default slide duration applied -->\n'}else{a+='<slideDuration>'+$('#duration').val()+'</slideDuration>\n'}a+='</setup>\n';return a}function getTopics(){var a='<!-- IMAGES -->\n';var b,title,description;for(var i=1;i<=topicNum;i++){if(isEmpty($('#fName'+i).val())){b='REQUIRED';$('#fName'+i).addClass('error');$('#fName'+i).attr('placeholder','REQUIRED');fileError=true}else{b=$('#fName'+i).val();if($('#fName'+i).hasClass('error')){$('#fName'+i).removeClass('error');fileError=false}}a+='<image fileName="'+b+'">\n';if(isEmpty($('#topic'+i).val())){title='REQUIRED';$('#topic'+i).addClass('error');$('#topic'+i).attr('placeholder','REQUIRED');topicError=true}else{title=$('#topic'+i).val().replace('\&','&amp;');if($('#topic'+i).hasClass('error')){$('#topic'+i).removeClass('error');topicError=false}}description=$('#vDes'+i).val();if(description==''||description==undefined){description=''}else{description='<![CDATA['+description+']]>'}a+='<title>'+title+'</title>\n';a+='<description>'+description+'</description>\n';a+='</image>\n'}return a}function isEmpty(a){var b=/^[\s ]*$/gi;return b.test(a)}function handleFileSelect(a){var b=a.dataTransfer.files[0];var c;a.stopPropagation();a.preventDefault();if(b.type!='text/xml'){c='<p style="color:#f00"><strong>'+escape(b.name)+'</strong> is not an XML file. It is a(n) '+(b.type||'unknown')+' file type. Please try again.</p>'}else{c='<p><strong>'+escape(b.name)+'</strong> - '+b.size+' bytes'+'</p>';c+='<p>Uploading ...</p>';$('.loader').show();loadXML(b)}$('#fileResult').html(c)}function handleDragOver(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect='copy'}function loadXML(d){if(d){var f=new FileReader();f.onload=(function(c){return function(e){var a=new DOMParser();var b=a.parseFromString(e.target.result,"text/xml");$('#fileResult').append('<p>Reading ... </p>');if(b.getElementsByTagName("gallery")[0]==undefined){$('#fileResult').append('<p class="error"><i class="icon-warning-sign icon"></i> This XML file is not the correct file for this player. Please double check your XML file and try again.</p>')}else{parseXML(b)}}})(d);f.readAsText(d,'UTF-8')}else{$('#fileResult').append('<p><i class="icon-warning-sign icon-white"></i> Failed to read XML.</p>')}}function parseXML(a){var b=a.getElementsByTagName("image").length,needMore=a.getElementsByTagName("image").length-topicNum,imageType,slideDur,title,desc;$('#fileResult').append('<p>Filling form ...</p>');if(!a.getElementsByTagName("imgFormat")[0].childNodes.length==0){imageType=a.getElementsByTagName("imgFormat")[0].childNodes[0].nodeValue;$("#imageType").val(imageType)}if(!a.getElementsByTagName("slideDuration")[0].childNodes.length==0){slideDur=a.getElementsByTagName("slideDuration")[0].childNodes[0].nodeValue;$("#duration").val(slideDur)}$("#galleryTitle").val(a.getElementsByTagName("galleryTitle")[0].childNodes[0].nodeValue);$("#galleryDesc").val(a.getElementsByTagName("galleryDescription")[0].childNodes[0].nodeValue);addImages(needMore,a);$('#fileResult').append('<p>Finished! Your XML has been uploaded successfully.</p>');$('.loader').hide()}function addImages(m,x){for(var i=1;i<=m;i++){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"> <span class="number">'+topicNum+'</span></div><div class="span11"><div class="row"><div class="span5"><label for="fName'+topicNum+'">File Name:</label><input type="text" class="span5" name="fName'+topicNum+'" id="fName'+topicNum+'"/></div><div class="span6"><label for="topic'+topicNum+'">Image title:</label><input type="text" class="span6" name="topic'+topicNum+'" id="topic'+topicNum+'"/></div><div class="span11"><label for="vDes'+topicNum+'">Images description:</label><textarea class="span11" name="vDes'+topicNum+'" id="vDes'+topicNum+'"></textarea></div></div></div></div>');applyTinymce('#vDes'+topicNum)}fillImages(x)}function fillImages(x){for(var i=0;i<topicNum;i++){var a=x.getElementsByTagName("image")[i].attributes.getNamedItem("fileName").value,title=x.getElementsByTagName("title")[i].childNodes[0].nodeValue,description;if(x.getElementsByTagName("description")[i].childNodes.length==0||isEmpty(x.getElementsByTagName("description")[i].childNodes[0].nodeValue)){description=""}else{description=x.getElementsByTagName("description")[i].childNodes[0].nodeValue}$('#fName'+(i+1)).val(a);$('#topic'+(i+1)).val(title);$('#vDes'+(i+1)).val(description)}}function applyTinymce(a){$(a).tinymce({script_url:'scripts/tiny_mce/tiny_mce.js',theme:"advanced",skin:"o2k7",skin_variant:"silver",plugins:"autolink,lists,pagebreak,table,advlink,iespell,inlinepopups,paste,directionality,noneditable,visualchars,nonbreaking,xhtmlxtras,template,advlist",theme_advanced_buttons1:"bold,italic,underline,forecolor,|,justifyleft,justifycenter,justifyright,|,bullist,numlist,sub,sup,|,link,unlink,charmap,|,tablecontrols,|,visualaid,|,cut,copy,paste,removeformat,code,cleanup",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"center",theme_advanced_resizing:true,content_css:"css/tinymce.css",template_external_list_url:"lists/template_list.js",external_link_list_url:"lists/link_list.js",})}});