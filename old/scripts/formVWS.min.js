// formVWS.min.js
// by Ethan S. Lin
// 10-18-2012 @ 12:52 pm

$(document).ready(function(){var g=false,topicNum=5,groupCounter=0,copy,entered=false,fileError=false,dropZone=document.getElementById('drop_zone');initialize();function initialize(){if(window.File&&window.FileReader&&window.FileList){$('#browse, #closeFile').click(function(){$('#fileModel').modal('toggle');$('#fileResult').html('');$('.loader').hide()})}else{$('#browse').addClass('disabled').removeClass('btn-primary').addClass('btn-danger').html('<i class="icon-warning-sign icon-white"></i> Your browser does not support local file upload.')}dropZone.addEventListener('dragover',handleDragOver,false);dropZone.addEventListener('drop',handleFileSelect,false);$('#xmlArea').hide();$('.loader').hide();$('#closeRUModel').bind('click',function(){$('#areUSure').modal('toggle')});$('#closeSRYModel').bind('click',function(){$('#sorryNoCanDo').modal('toggle')});$('#player a').bind('click',function(){if(g===false){$('.tab-pane').show('slow');$(this).removeClass('tabShadow');$(this).html('<i class="icon-chevron-up"></i> SELECT A DIFFERENT XML FILE');g=true}else{$('.tab-pane').hide('slow');$(this).addClass('tabShadow');$(this).html('<i class="icon-chevron-down"></i> SELECT A DIFFERENT XML FILE');g=false}});$('#groups').bind('change',function(){var a;$(this).val().replace('/(\s)/','');if(isNaN($(this).val())){if(entered==true){$(this).val(copy)}else{$(this).val('').attr('placeholder','enter a number').addClass('error')}}else{if($(this).hasClass('error')){$(this).removeClass('error')}if($(this).val().match(' ')){$(this).val('').attr('placeholder','i.e.: 2, 3, 5, etc.');if(!$('#group').hasClass('hide')){$('.groupRow').html('');$('#group').addClass('hide')}}else{a=$(this).val();if(a!=0){showGroup(a)}else if(a==0){if(!$('#group').hasClass('hide')){$('.groupRow').html('');$('#group').addClass('hide')}groupCounter=0}else{if(!$('#group').hasClass('hide')){$('#group').addClass('hide')}$('.groupRow').html('');groupCounter=0}copy=a;entered=true}addGroupSelection($(this).val())}});bindExRes(1);bindExRes(2);bindExRes(3);bindExRes(4);bindExRes(5);applyTinymce('#vDes1');applyTinymce('#vDes2');applyTinymce('#vDes3');applyTinymce('#vDes4');applyTinymce('#vDes5')}function showGroup(a){var i,minus=false;if($('#group').hasClass('hide')){$('#group').removeClass('hide')}if(a>groupCounter){a=a-groupCounter;minus=false}else{a=groupCounter-a;minus=true}if(minus==false){for(i=0;i<a;i++){$('.groupRow').append('<div class="span2"><input type="text" class="span2" placeholder="group '+(groupCounter+1)+'" /></div>');groupCounter++}}else{for(i=0;i<a;i++){$('.groupRow div.span2:last').remove();groupCounter--}}}function addGroupSelection(i){$('.groupSelect').html('<option value=" " selected></option><option value="0">0</option>');for(var j=0;j<i;j++){$('.groupSelect').append('<option value="'+(j+1)+'">'+(j+1)+'</option>')}}function bindExRes(i){$('input[name=src'+i+']').bind('click',function(){var a=$(this).val();if(a=="yes"){if($('#embedTxt'+i+'').hasClass('hide')){$('#embedTxt'+i+'').removeClass('hide')}}else{if(!$('#embedTxt'+i+'').hasClass('hide')){$('#embedTxt'+i+'').addClass('hide');$('#srcEmbed'+i+'').val('')}}})}$('#plusMoreTopic').bind('click',function(){var a=$('#topicNumInput').val();if(!isNaN(a)){for(var i=1;i<=a;i++){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"> <span class="number">'+topicNum+'</span></div><div class="span11"><div class="row"><div class="span7"><label for="fName'+topicNum+'">File Name:</label><input type="text" class="span7" name="fName'+topicNum+'" id="fName'+topicNum+'"/></div><div class="span2"><label for="group'+topicNum+'">Group Number:</label><select type="text" name="group'+topicNum+'" id="group'+topicNum+'" class="span2 groupSelect"></select></div><div class="span2"><label>External Source:</label><label class="radio inline"><input type="radio" name="src'+topicNum+'" id="src'+topicNum+'" value="yes" /> Yes </label><label class="radio inline"><input type="radio" name="src'+topicNum+'" value="no" checked /> No </label></div><div class="span7"><label for="topic'+topicNum+'">Video title:</label><input type="text" class="span7" name="topic'+topicNum+'" id="topic'+topicNum+'"/></div><div class="span4"><label for="vidAuth'+topicNum+'">Video author(s):</label><input type="text" class="span4" name="vidAuth'+topicNum+'" id="vidAuth'+topicNum+'"/></div><div class="span11 hide" id="embedTxt'+topicNum+'"><label for="srcEmbed'+topicNum+'">External Embed Code:</label><input type="text" class="span11" name="srcEmbed'+topicNum+'" id="srcEmbed'+topicNum+'"/></div><div class="span11"><label for="vDes'+topicNum+'">Video description:</label><textarea class="span11" name="vDes'+topicNum+'" id="vDes'+topicNum+'"></textarea></div></div></div></div>');bindExRes(topicNum);applyTinymce('#vDes'+topicNum);addGroupSelection(groupCounter)}$('#topicNumInput').val(5);if($('#topicNumInput').hasClass('error')===true){$('#topicNumInput').removeClass('error')}$('.errorText').hide('fast')}else{if($('#topicNumInput').hasClass('error')===false){$('#topicNumInput').addClass('error')}$('.errorText').show('slow')}});$('#plusTopic').bind('click',function(){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"> <span class="number">'+topicNum+'</span></div><div class="span11"><div class="row"><div class="span7"><label for="fName'+topicNum+'">File Name:</label><input type="text" class="span7" name="fName'+topicNum+'" id="fName'+topicNum+'"/></div><div class="span2"><label for="group'+topicNum+'">Group Number:</label><select type="text" name="group'+topicNum+'" id="group'+topicNum+'" class="span2 groupSelect"></select></div><div class="span2"><label>External Source:</label><label class="radio inline"><input type="radio" name="src'+topicNum+'" id="src'+topicNum+'" value="yes" /> Yes </label><label class="radio inline"><input type="radio" name="src'+topicNum+'" value="no" checked /> No </label></div><div class="span7"><label for="topic'+topicNum+'">Video title:</label><input type="text" class="span7" name="topic'+topicNum+'" id="topic'+topicNum+'"/></div><div class="span4"><label for="vidAuth'+topicNum+'">Video author(s):</label><input type="text" class="span4" name="vidAuth'+topicNum+'" id="vidAuth'+topicNum+'"/></div><div class="span11 hide" id="embedTxt'+topicNum+'"><label for="srcEmbed'+topicNum+'">External Embed Code:</label><input type="text" class="span11" name="srcEmbed'+topicNum+'" id="srcEmbed'+topicNum+'"/></div><div class="span11"><label for="vDes'+topicNum+'">Video description:</label><textarea class="span11" name="vDes'+topicNum+'" id="vDes'+topicNum+'"></textarea></div></div></div></div>');bindExRes(topicNum);applyTinymce('#vDes'+topicNum);addGroupSelection(groupCounter)});$('#minusTopic').bind('click',function(){var a=$('div.topic:last');if(topicNum>1){a.remove();topicNum--;$('#areUSure').modal('toggle')}else{$('#areUSure').modal('toggle');$('#sorryNoCanDo').modal('toggle')}});$('#backToTop').bind('click',function(){$('html, body').animate({scrollTop:0},'slow');$('#down').show()});$('#down').bind('click',function(a){a.preventDefault();$('html, body').animate({scrollTop:$(this.hash).offset().top},'slow')});$('#getCode').bind('click',function(){var a=new Date();var b=(a.getMonth()+1)+'/'+(a.getDate())+'/'+a.getFullYear()+'|'+a.getHours()+':'+a.getMinutes()+':'+a.getSeconds();$('#xmlOutput').val('<?xml version="1.0" encoding="UTF-8"?>\n<!-- Generated on '+b+' -->\n<wall>\n'+getPlayerSetup()+getTopics()+'</wall>');$('a#getCode').fancybox({'hideOnContentClick':false,'scrolling':'auto','autoScale':true,'autoDimensions':true,'centerOnScroll':true});$('#xmlError').html('');$('#xmlError').append('<ul>');if(fileError){$('#xmlError ul').append('<li>One or more of the video file name is not specified.</li>')}$('#xmlError').append('</ul>')});function getPlayerSetup(){var a='<!-- VIDEO WALL SETUP -->\n';a+='<setup>\n';if($('#imageType').val()==='jpg'){a+='<imgFormat /> <!-- default image type applied -->\n'}else{a+='<imgFormat>'+$('#imageType').val()+'</imgFormat>\n'}if($('#groups').val()==0||isEmpty($('#groups').val())){a+='<group total="0" />\n'}else{a+='<group total="'+$('#groups').val()+'">\n';for(var i=0;i<$('#groups').val();i++){a+='<name group="'+(i+1)+'">'+$('.groupRow input:eq('+i+')').val()+'</name>\n'}a+='</group>\n'}a+='</setup>\n';return a}function getTopics(){var a='<!-- VIDEOS -->\n';var b,group,author,title,description,src;for(var i=1;i<=topicNum;i++){if(isEmpty($('#fName'+i).val())){b='REQUIRED';$('#fName'+i).addClass('error');$('#fName'+i).attr('placeholder','REQUIRED');fileError=true}else{b=$('#fName'+i).val();if($('#fName'+i).hasClass('error')){$('#fName'+i).removeClass('error');fileError=false}}group=$('#group'+i).val().replace(" ","");a+='<video fileName="'+b+'" group="'+group+'">\n';title=$('#topic'+i).val().replace('\&','&amp;');if(title==''||title==undefined){title=''}src=$('#srcEmbed'+i).val();if($('#src'+i+':checked').val()=='yes'){a+='<src><![CDATA['+src+']]></src>\n'}else{a+='<src></src>\n'}author=$('#vidAuth'+i).val();if(author==''||author==undefined){author=''}description=$('#vDes'+i).val();if(description==''||description==undefined){description=''}else{description='<![CDATA['+description+']]>'}a+='<author>'+author+'</author>\n';a+='<title>'+title+'</title>\n';a+='<description>'+description+'</description>\n';a+='</video>\n'}return a}function isEmpty(a){var b=/^[\s ]*$/gi;return b.test(a)}function handleFileSelect(a){var b=a.dataTransfer.files[0];var c;a.stopPropagation();a.preventDefault();if(b.type!='text/xml'){c='<p style="color:#f00"><strong>'+escape(b.name)+'</strong> is not an XML file. It is a(n) '+(b.type||'unknown')+' file type. Please try again.</p>'}else{c='<p><strong>'+escape(b.name)+'</strong> - '+b.size+' bytes'+'</p>';c+='<p>Uploading ...</p>';$('.loader').show();loadXML(b)}$('#fileResult').html(c)}function handleDragOver(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect='copy'}function loadXML(d){if(d){var f=new FileReader();f.onload=(function(c){return function(e){var a=new DOMParser();var b=a.parseFromString(e.target.result,"text/xml");$('#fileResult').append('<p>Reading ... </p>');if(b.getElementsByTagName("wall")[0]==undefined){$('#fileResult').append('<p class="error"><i class="icon-warning-sign icon"></i> This XML file is not the correct file for this player. Please double check your XML file and try again.</p>')}else{parseXML(b)}}})(d);f.readAsText(d,'UTF-8')}else{$('#fileResult').append('<p><i class="icon-warning-sign icon-white"></i> Failed to read XML.</p>')}}function parseXML(a){var b=a.getElementsByTagName("video").length,needMore=a.getElementsByTagName("video").length-topicNum,imageType,groupTotal=a.getElementsByTagName("group")[0].attributes.getNamedItem("total").value;$('#fileResult').append('<p>Filling form ...</p>');if(!a.getElementsByTagName("imgFormat")[0].childNodes.length==0){imageType=a.getElementsByTagName("imgFormat")[0].childNodes[0].nodeValue;$("#imageType").val(imageType)}if(groupTotal>0){$('#groups').val(groupTotal);showGroup(groupTotal);fillGroup(groupTotal,a)}addVideos(needMore,a);$('#fileResult').append('<p>Finished! Your XML has been uploaded successfully.</p>');$('.loader').hide()}function fillGroup(i,x){for(var j=0;j<i;j++){$('.groupRow input:eq('+j+')').val(x.getElementsByTagName("name")[j].childNodes[0].nodeValue)}}function addVideos(m,x){for(var i=1;i<=m;i++){topicNum++;$('#topics').append('<div class="row topic"><hr /><div class="span1"> <span class="number">'+topicNum+'</span></div><div class="span11"><div class="row"><div class="span7"><label for="fName'+topicNum+'">File Name:</label><input type="text" class="span7" name="fName'+topicNum+'" id="fName'+topicNum+'"/></div><div class="span2"><label for="group'+topicNum+'">Group Number:</label><select type="text" name="group'+topicNum+'" id="group'+topicNum+'" class="span2 groupSelect"></select></div><div class="span2"><label>External Source:</label><label class="radio inline"><input type="radio" name="src'+topicNum+'" id="src'+topicNum+'" value="yes" /> Yes </label><label class="radio inline"><input type="radio" name="src'+topicNum+'" value="no" checked /> No </label></div><div class="span7"><label for="topic'+topicNum+'">Video title:</label><input type="text" class="span7" name="topic'+topicNum+'" id="topic'+topicNum+'"/></div><div class="span4"><label for="vidAuth'+topicNum+'">Video author(s):</label><input type="text" class="span4" name="vidAuth'+topicNum+'" id="vidAuth'+topicNum+'"/></div><div class="span11 hide" id="embedTxt'+topicNum+'"><label for="srcEmbed'+topicNum+'">External Embed Code:</label><input type="text" class="span11" name="srcEmbed'+topicNum+'" id="srcEmbed'+topicNum+'"/></div><div class="span11"><label for="vDes'+topicNum+'">Video description:</label><textarea class="span11" name="vDes'+topicNum+'" id="vDes'+topicNum+'"></textarea></div></div></div></div>');bindExRes(topicNum);applyTinymce('#vDes'+topicNum);addGroupSelection(groupCounter)}fillVideo(x)}function fillVideo(x){for(var i=0;i<topicNum;i++){var a=x.getElementsByTagName("video")[i].attributes.getNamedItem("fileName").value,group,src,author,title,description;if(x.getElementsByTagName("video")[i].attributes.getNamedItem("group").value==undefined||isEmpty(x.getElementsByTagName("video")[i].attributes.getNamedItem("group").value)){group=""}else{group=x.getElementsByTagName("video")[i].attributes.getNamedItem("group").value}if(x.getElementsByTagName("src")[i].childNodes.length==0||isEmpty(x.getElementsByTagName("src")[i].childNodes.nodeValue)){$('input:radio[name=src'+(i+1)+']:nth(1)').attr('checked',true)}else{$('input:radio[name=src'+(i+1)+']:nth(0)').attr('checked',true);src=x.getElementsByTagName("src")[i].childNodes[0].nodeValue;if($('#embedTxt'+(i+1)).hasClass('hide')){$('#embedTxt'+(i+1)).removeClass('hide')}$('#srcEmbed'+(i+1)).val(src)}if(x.getElementsByTagName("author")[i].childNodes.length==0||isEmpty(x.getElementsByTagName("author")[i].childNodes[0].nodeValue)){author=""}else{author=x.getElementsByTagName("author")[i].childNodes[0].nodeValue}if(x.getElementsByTagName("title")[i].childNodes.length==0||isEmpty(x.getElementsByTagName("title")[i].childNodes[0].nodeValue)){title=""}else{title=x.getElementsByTagName("title")[i].childNodes[0].nodeValue}if(x.getElementsByTagName("description")[i].childNodes.length==0||isEmpty(x.getElementsByTagName("description")[i].childNodes[0].nodeValue)){description=""}else{description=x.getElementsByTagName("description")[i].childNodes[0].nodeValue}$('#fName'+(i+1)).val(a);$('#group'+(i+1)).val(group);$('#vidAuth'+(i+1)).val(author);$('#topic'+(i+1)).val(title);$('#vDes'+(i+1)).val(description)}}function applyTinymce(a){$(a).tinymce({script_url:'scripts/tiny_mce/tiny_mce.js',theme:"advanced",skin:"o2k7",skin_variant:"silver",plugins:"autolink,lists,pagebreak,table,advlink,iespell,inlinepopups,paste,directionality,noneditable,visualchars,nonbreaking,xhtmlxtras,template,advlist",theme_advanced_buttons1:"bold,italic,underline,forecolor,|,justifyleft,justifycenter,justifyright,|,bullist,numlist,sub,sup,|,link,unlink,charmap,|,tablecontrols,|,visualaid,|,cut,copy,paste,removeformat,code,cleanup",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_resizing:true,content_css:"css/tinymce.css",template_external_list_url:"lists/template_list.js",external_link_list_url:"lists/link_list.js",})}});